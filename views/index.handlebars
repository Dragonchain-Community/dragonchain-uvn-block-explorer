<div id="node-info">
	<span class="spinner-border spinner-border-sm text-primary"></span>
	Loading...
</div>

<script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script>
<script type="text/javascript">
	$(function () {
		// Check for existing credentials in 1) sessionstorage, 2) (encrypted) in localstorage

		if (window.sessionStorage.credentials)
		{
			var credentials = JSON.parse(window.sessionStorage.credentials);
			$.ajax({
				url: "/get-node-info",
				method: "POST",
				data: {
					public_id: credentials.public_id,
					access_id: credentials.access_id,
					access_key: credentials.access_key,
					endpoint_url: credentials.endpoint_url
				},				
				dataType: "html"
			})			
				.done(function (data) {
					$("#node-info").html(data);
					$("#logout")
						.removeClass("d-none")
						.click(function () {
							window.localStorage.removeItem("credentials_secure")
							window.sessionStorage.removeItem("credentials");
							document.location.href = "/login";
						})
				})
			
		} else if (window.localStorage.credentials_secure)
		{
			// Redirect to verify //
			document.location.href = "/verify";

		} else {
			// Redirect to login //
			document.location.href = "/login";
		}

	});	
	
</script>